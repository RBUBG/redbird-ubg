<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Red Snake</title>
<style>
body{margin:0;font-family:sans-serif;background:#0d1117;color:#e6edf3;display:flex;flex-direction:column;height:100vh;}
header,footer{background:#161b22;padding:8px 16px;display:flex;justify-content:space-between;align-items:center;}
header h1{margin:0;font-size:18px;}
.btn{background:#242b33;border:1px solid #2f3742;color:#e6edf3;padding:4px 8px;border-radius:8px;cursor:pointer;}
main{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#14532d;}
#levelUI{width:90%;max-width:1100px;margin-bottom:8px;text-align:center;}
#levelText{margin-bottom:4px;font-size:20px;font-weight:bold;}
#levelProgress{width:100%;height:12px;background:#2f3742;border-radius:6px;overflow:hidden;}
#levelProgressFill{height:100%;width:0%;background:#ef4444;border-radius:6px;transition:width 0.2s;}
#goldenText{position:absolute;top:60px;font-size:24px;color:gold;font-weight:bold;text-align:center;width:100%;display:none;}
canvas{background:#14532d;border-radius:12px;}
</style>
</head>
<body>
<header>
<h1>Red Snake</h1>
<button id="resetBtn" class="btn">Reset</button>
</header>
<main>
<div id="levelUI">
<div id="levelText">Level: 1</div>
<div id="levelProgress"><div id="levelProgressFill"></div></div>
</div>
<div id="goldenText">Golden Apple!</div>
<canvas id="canvas" width="800" height="600"></canvas>
</main>
<footer>
<div id="hud">Score: 0 • Length: 80 • Level: 1 • Best: 0</div>
</footer>
<script>
const canvas=document.getElementById('canvas'),ctx=canvas.getContext('2d');
const hud=document.getElementById('hud'),levelText=document.getElementById('levelText');
const levelProgressFill=document.getElementById('levelProgressFill');
const goldenText=document.getElementById('goldenText');
const resetBtn=document.getElementById('resetBtn');
const W=canvas.width,H=canvas.height,bounds={x:20,y:20,w:W-40,h:H-40};
let state,bestScore=0;
const keys=new Set();
let goldenTimer=0;

function saveState(){
  localStorage.setItem('redSnake',JSON.stringify({
    level:state.level,
    applesCollected:state.applesCollected,
    bestScore:bestScore,
    maxTrailLen:state.maxTrailLen
  }));
}

function loadState(){
  const saved=localStorage.getItem('redSnake');
  if(saved){
    const s=JSON.parse(saved);
    bestScore=s.bestScore||0;
    return {level:s.level||1,applesCollected:s.applesCollected||0,maxTrailLen:s.maxTrailLen||80};
  }
  return {level:1,applesCollected:0,maxTrailLen:80};
}

window.addEventListener('keydown',e=>{
  keys.add(e.key.toLowerCase());
  if(e.key.toLowerCase()==='r' && !state.alive) reset(false);
});
window.addEventListener('keyup',e=>keys.delete(e.key.toLowerCase()));

function rand(a,b){return Math.random()*(b-a)+a;}
function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y);}
function spawnApple(){return {x:rand(bounds.x,bounds.x+bounds.w),y:rand(bounds.y,bounds.y+bounds.h),r:10,type:'normal'};}
function spawnGoldenApple(){return {x:rand(bounds.x,bounds.x+bounds.w),y:rand(bounds.y,bounds.y+bounds.h),r:10,type:'golden'};}

function reset(full=true){
  const loaded=loadState();
  if(full){
    state={alive:true,score:0,snake:{x:W/2,y:H/2,angle:-Math.PI/2,speed:2.5,turnSpeed:0.05,width:12},
      trail:[],maxTrailLen:loaded.maxTrailLen,apples:Array.from({length:10},()=>spawnApple()),
      particles:[],level:loaded.level,applesCollected:loaded.applesCollected};
  } else {
    state.alive=true;
    state.snake={x:W/2,y:H/2,angle:-Math.PI/2,speed:2.5,turnSpeed:0.05,width:12};
    state.trail=[];
    state.apples=Array.from({length:10},()=>spawnApple());
    state.particles=[];
  }
  goldenTimer=0;
  goldenText.style.display='none';
  updateHUD();updateLevelUI();
}

function updateHUD(){hud.textContent=`Score: ${state.score} • Length: ${state.maxTrailLen} • Level: ${state.level} • Best: ${bestScore}`;}
function updateLevelUI(){levelText.textContent=`Level: ${state.level}`;levelProgressFill.style.width=((state.applesCollected%20)/20*100)+'%';}

function handleInput(){
const s=state.snake;
const left=keys.has('a')||keys.has('arrowleft'),right=keys.has('d')||keys.has('arrowright');
const up=keys.has('w')||keys.has('arrowup'),down=keys.has('s')||keys.has('arrowdown'),boost=keys.has('shift');
const baseSpeed=2.5; // constant base speed
let targetSpeed=baseSpeed;
if(up) targetSpeed+=1;
if(down) targetSpeed-=1;
if(goldenTimer>0) targetSpeed+=2; // golden apple boost
s.speed+=(targetSpeed-s.speed)*0.08*(boost?1.5:1);
if(left)s.angle-=s.turnSpeed*(boost?0.9:1);
if(right)s.angle+=s.turnSpeed*(boost?0.9:1);
}

function integrate(){
const s=state.snake;
s.x+=Math.cos(s.angle)*s.speed;s.y+=Math.sin(s.angle)*s.speed;
if(s.x<bounds.x){s.x=bounds.x;s.angle=Math.PI-s.angle;}
if(s.x>bounds.x+bounds.w){s.x=bounds.x+bounds.w;s.angle=Math.PI-s.angle;}
if(s.y<bounds.y){s.y=bounds.y;s.angle=-s.angle;}
if(s.y>bounds.y+bounds.h){s.y=bounds.y+bounds.h;s.angle=-s.angle;}
state.trail.push({x:s.x,y:s.y});if(state.trail.length>state.maxTrailLen)state.trail.shift();
}

function collectApples(){
const spos={x:state.snake.x,y:state.snake.y};
for(let i=state.apples.length-1;i>=0;i--){
let a=state.apples[i];
if(dist(spos,a)<a.r+10){
state.apples.splice(i,1);
state.score+=10;
state.maxTrailLen=Math.min(320,state.maxTrailLen+3);
state.applesCollected++;
// Spawn golden apple once every 65 apples
if(state.applesCollected%65===0) state.apples.push(spawnGoldenApple());
else state.apples.push(spawnApple());

// Level update
state.level=Math.min(50,Math.floor(state.applesCollected/20)+1);
updateLevelUI();
saveState();

// Golden apple effect
if(a.type==='golden'){
  goldenTimer=600; // ~10 seconds at 60fps
  goldenText.style.display='block';
}}
}
}

function checkSelfCollision(){const s=state.snake;const head={x:s.x,y:s.y};for(let i=0;i<state.trail.length-12;i++){if(dist(head,state.trail[i])<s.width){state.alive=false;if(state.score>bestScore)bestScore=state.score;saveState();}}}

function drawRoundRect(ctx,x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.lineTo(x+w-r,y);ctx.quadraticCurveTo(x+w,y,x+w,y+r);ctx.lineTo(x+w,y+h-r);ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);ctx.lineTo(x+r,y+h);ctx.quadraticCurveTo(x,y+h,x,y+h-r);ctx.lineTo(x,y+r);ctx.quadraticCurveTo(x,y,x+r,y);ctx.closePath();ctx.fill();}

function draw(){
ctx.clearRect(0,0,W,H);
ctx.strokeStyle='#064e3b';ctx.lineWidth=2;ctx.strokeRect(bounds.x,bounds.y,bounds.w,bounds.h);

// Draw apples
for(const a of state.apples){
  ctx.fillStyle=(a.type==='golden')?'#facc15':'#22c55e';
  ctx.beginPath();
  ctx.arc(a.x,a.y,a.r,0,Math.PI*2);
  ctx.fill();
  // Draw stem
  ctx.strokeStyle='#14532d';
  ctx.lineWidth=2;
  ctx.beginPath();
  ctx.moveTo(a.x,a.y-a.r);
  ctx.lineTo(a.x,a.y-a.r-6);
  ctx.stroke();
}

// Draw trail
if(state.trail.length>1){
ctx.strokeStyle='#dc2626';ctx.lineWidth=10;ctx.lineJoin='round';
ctx.beginPath();ctx.moveTo(state.trail[0].x,state.trail[0].y);
for(let i=1;i<state.trail.length;i++)ctx.lineTo(state.trail[i].x,state.trail[i].y);
ctx.stroke();
}

// Draw snake
ctx.save();ctx.translate(state.snake.x,state.snake.y);ctx.rotate(state.snake.angle);
ctx.fillStyle='#ef4444';drawRoundRect(ctx,-12,-8,24,16,6);
ctx.restore();

// Draw crash screen
if(!state.alive){
ctx.fillStyle='#0008';ctx.fillRect(0,0,W,H);
ctx.fillStyle='#e11d48';ctx.font='48px sans-serif';ctx.textAlign='center';
ctx.fillText('Crashed!',W/2,H/2-12);
ctx.fillStyle='#e6edf3';ctx.font='22px sans-serif';
ctx.fillText('Press R to restart',W/2,H/2+28);
}
}

function loop(){
if(state.alive){
handleInput();integrate();collectApples();checkSelfCollision();updateHUD();
if(goldenTimer>0){goldenTimer--;if(goldenTimer===0) goldenText.style.display='none';}
}
draw();
requestAnimationFrame(loop);
}
resetBtn.addEventListener('click',()=>reset(false));
reset();loop();
</script>
</body>
</html>

